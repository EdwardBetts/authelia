import{G as fe,bi as pe,aa as de,ak as te,bj as he,bk as Ne,ag as ve,i as ge,bl as Le,r as O,x as ke,m as Ve,j as b,au as V,l as Me,u as We,L as Ue,R as $e}from"./index.2cf54ca8.js";import{u as Be}from"./hooks.Workflow.6e7bd503.js";import{S as Z,D as He}from"./portal.MethodContainer.1b18e563.js";import{c as Ke}from"./index.8057fcfb.js";import{S as qe}from"./portal.Authenticated.aec66e93.js";import{T as ze}from"./components.TimerIcon.f2cea1d7.js";import{I as Ge}from"./portal.IconWithContext.303a88e9.js";function pt(t){switch(t){case 0:return"SHA1";case 1:return"SHA256";case 2:return"SHA512"}}function ee(t){switch(t){case"SHA1":return 0;case"SHA256":return 1;case"SHA512":return 2}}function me(t){return{created_at:new Date(t.created_at),last_used_at:t.last_used_at?new Date(t.last_used_at):void 0,issuer:t.issuer,algorithm:ee(t.algorithm),digits:t.digits,period:t.period}}async function Qe(){const t=await fe(pe);return me(t)}async function Ye(){const t=await de.get(pe,{validateStatus:function(c){return c<300||c===404}});return t===null||t.status===404||t.data.status==="KO"?null:me(t.data.data)}async function dt(){const t=await fe(te);return{algorithm:ee(t.algorithm),algorithms:t.algorithms.map(c=>ee(c)),length:t.length,lengths:t.lengths,period:t.period,periods:t.periods}}async function ht(){return await de({method:"DELETE",url:he,validateStatus:Ne})}function Je(){return ve(Qe,[])}function vt(){return ve(Ye,[])}function Xe(t,c,j,N){const P={token:`${t}`,targetURL:c,workflow:j,workflowID:N};return ge(he,P)}function gt(t){const c={token:`${t}`};return ge(te,c)}function mt(){return Le(te)}var ye={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=P(O),j=["placeholder","separator","isLastChild","ariaLabelOverride","shouldRender","inputStyle","focus","isDisabled","hasErrored","errorStyle","isSuccessed","successStyle","focusStyle","disabledStyle","shouldAutoFocus","isInputNum","index","value","className","isInputSecure","onSubmit"];function N(n){if(typeof WeakMap!="function")return null;var o=new WeakMap,s=new WeakMap;return(N=function(a){return a?s:o})(n)}function P(n,o){if(!o&&n&&n.__esModule)return n;if(n===null||T(n)!=="object"&&typeof n!="function")return{default:n};var s=N(o);if(s&&s.has(n))return s.get(n);var e={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if(u!=="default"&&Object.prototype.hasOwnProperty.call(n,u)){var l=a?Object.getOwnPropertyDescriptor(n,u):null;l&&(l.get||l.set)?Object.defineProperty(e,u,l):e[u]=n[u]}return e.default=n,s&&s.set(n,e),e}function R(){return R=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var s=arguments[o];for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&(n[e]=s[e])}return n},R.apply(this,arguments)}function M(n,o){if(n==null)return{};var s=W(n,o),e,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(n);for(a=0;a<u.length;a++)e=u[a],!(o.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(n,e)&&(s[e]=n[e])}return s}function W(n,o){if(n==null)return{};var s={},e=Object.keys(n),a,u;for(u=0;u<e.length;u++)a=e[u],!(o.indexOf(a)>=0)&&(s[a]=n[a]);return s}function x(n,o){if(!(n instanceof o))throw new TypeError("Cannot call a class as a function")}function U(n,o){for(var s=0;s<o.length;s++){var e=o[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function $(n,o,s){return o&&U(n.prototype,o),s&&U(n,s),Object.defineProperty(n,"prototype",{writable:!1}),n}function F(n,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(o&&o.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),o&&L(n,o)}function L(n,o){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},L(n,o)}function h(n){var o=H();return function(){var e=D(n),a;if(o){var u=D(this).constructor;a=Reflect.construct(e,arguments,u)}else a=e.apply(this,arguments);return B(this,a)}}function B(n,o){if(o&&(T(o)==="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f(n)}function f(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function H(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(n){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},D(n)}function p(n,o,s){return o in n?Object.defineProperty(n,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[o]=s,n}function T(n){"@babel/helpers - typeof";return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},T(n)}var Ie=8,Se=37,Oe=39,be=46,Pe=32,Te=13,_=function(o){return T(o)==="object"},Ce=function(n){F(s,n);var o=h(s);function s(e){var a;return x(this,s),a=o.call(this,e),p(f(a),"getClasses",function(){for(var u=arguments.length,l=new Array(u),r=0;r<u;r++)l[r]=arguments[r];return l.filter(function(i){return!_(i)&&i!==!1}).join(" ")}),p(f(a),"getType",function(){var u=a.props,l=u.isInputSecure,r=u.isInputNum;return l?"password":r?"tel":"text"}),p(f(a),"getAriaLabel",function(u,l){var r=a.props.ariaLabelOverride;return r||"".concat(u===0?"Please enter verification code. ":"").concat(l?"Digit":"Character"," ").concat(u+1)}),a.input=c.default.createRef(),a}return $(s,[{key:"componentDidMount",value:function(){var a=this.props,u=a.focus,l=a.shouldAutoFocus,r=this.input.current;r&&u&&l&&r.focus()}},{key:"componentDidUpdate",value:function(a){var u=this.props.focus,l=this.input.current;a.focus!==u&&l&&u&&(l.focus(),l.select())}},{key:"render",value:function(){var a=this.props,u=a.placeholder,l=a.separator,r=a.isLastChild;a.ariaLabelOverride;var i=a.shouldRender,d=a.inputStyle,m=a.focus,S=a.isDisabled,y=a.hasErrored,v=a.errorStyle,I=a.isSuccessed,w=a.successStyle,E=a.focusStyle,C=a.disabledStyle;a.shouldAutoFocus;var q=a.isInputNum,z=a.index,K=a.value,G=a.className;a.isInputSecure,a.onSubmit;var Q=M(a,j);return c.default.createElement("div",{className:G,style:{display:"flex",alignItems:"center"}},c.default.createElement("input",R({"aria-label":this.getAriaLabel(z,q),style:Object.assign({width:"1em",textAlign:"center",padding:0},_(d)&&d,m&&_(E)&&E,S&&_(C)&&C,y&&!I&&_(v)&&v,I&&!y&&_(w)&&w),placeholder:u,className:this.getClasses(d,m&&E,S&&C,y&&!I&&v,I&&!y&&w),type:this.getType(),ref:this.input,disabled:S,value:K||""},Q)),!r&&i&&l)}}]),s}(c.PureComponent),ne=function(n){F(s,n);var o=h(s);function s(){var e;x(this,s);for(var a=arguments.length,u=new Array(a),l=0;l<a;l++)u[l]=arguments[l];return e=o.call.apply(o,[this].concat(u)),p(f(e),"state",{activeInput:0}),p(f(e),"getOtpValue",function(){return e.props.value?e.props.value.toString().split(""):[]}),p(f(e),"getPlaceholderValue",function(){var r=e.props,i=r.placeholder,d=r.numInputs;if(typeof i=="string"){if(i.length===d)return i;i.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}}),p(f(e),"handleOtpChange",function(r){var i=e.props.onChange,d=r.join("");i(d)}),p(f(e),"isInputValueValid",function(r){var i=e.props.isInputNum?!isNaN(parseInt(r,10)):typeof r=="string";return i&&r.trim().length===1}),p(f(e),"focusInput",function(r){var i=e.props.numInputs,d=Math.max(Math.min(i-1,r),0);e.setState({activeInput:d})}),p(f(e),"focusNextInput",function(){var r=e.state.activeInput;e.focusInput(r+1)}),p(f(e),"focusPrevInput",function(){var r=e.state.activeInput;e.focusInput(r-1)}),p(f(e),"changeCodeAtFocus",function(r){var i=e.state.activeInput,d=e.getOtpValue();d[i]=r[0],e.handleOtpChange(d)}),p(f(e),"handleOnPaste",function(r){r.preventDefault();var i=e.state.activeInput,d=e.props,m=d.numInputs,S=d.isDisabled;if(!S){for(var y=e.getOtpValue(),v=i,I=r.clipboardData.getData("text/plain"),w=e.props.isInputNum?I.replace(/\D/g,""):I,E=w.slice(0,m-i).split(""),C=0;C<m;++C)C>=i&&E.length>0&&(y[C]=E.shift(),v++);e.setState({activeInput:v},function(){e.focusInput(v),e.handleOtpChange(y)})}}),p(f(e),"handleOnChange",function(r){var i=r.target.value;e.isInputValueValid(i)&&e.changeCodeAtFocus(i)}),p(f(e),"handleOnKeyDown",function(r){r.keyCode===Ie||r.key==="Backspace"?(r.preventDefault(),e.changeCodeAtFocus(""),e.focusInput(e.state.activeInput-1)):r.keyCode===be||r.key==="Delete"?(r.preventDefault(),e.changeCodeAtFocus("")):r.keyCode===Se||r.key==="ArrowLeft"?(r.preventDefault(),e.focusPrevInput()):r.keyCode===Oe||r.key==="ArrowRight"?(r.preventDefault(),e.focusNextInput()):r.keyCode===Pe||r.key===" "||r.key==="Spacebar"||r.key==="Space"?r.preventDefault():(r.keyCode===Te||r.key==="Enter")&&e.props.onSubmit()}),p(f(e),"handleOnInput",function(r){var i=r.target.value;if(r.target.value){if(r.target.value&&r.target.value.length>1){r.preventDefault();for(var d=e.props.numInputs,m=e.state.activeInput,S=e.getOtpValue(),y=r.target.value.slice(0,d-m).split(""),v=0;v<d;++v)v>=m&&y.length>0&&(S[v]=y.shift());e.handleOtpChange(S),e.focusInput(e.props.numInputs)}else if(i&&i.trim().length>1)r.clipboardData={getData:function(){return i.trim()}},e.handleOnPaste(r);else if(e.isInputValueValid(r.target.value))e.focusNextInput();else if(!e.props.isInputNum){var I=r.nativeEvent;I.data===null&&I.inputType==="deleteContentBackward"&&(r.preventDefault(),e.changeCodeAtFocus(""),e.focusPrevInput())}}}),p(f(e),"renderInputs",function(){for(var r=e.state.activeInput,i=e.props,d=i.id,m=i.autoComplete,S=i.numInputs,y=i.inputStyle,v=i.focusStyle,I=i.separator,w=i.separateAfter,E=w===void 0?1:w,C=i.isDisabled,q=i.disabledStyle,z=i.hasErrored,K=i.errorStyle,G=i.isSuccessed,Q=i.successStyle,De=i.shouldAutoFocus,_e=i.isInputNum,Ee=i.isInputSecure,Ae=i.className,k=i.inputProps,Re=i.onSubmit,re=[],ae=e.getOtpValue(),oe=e.getPlaceholderValue(),ie=e.props["data-cy"],se=e.props["data-testid"],ue=e.props["custom-test-attr"],ce=e.props["custom-test-id"],xe=function(g){var J=void 0;(g+1)%parseInt(E)===0?J=!0:J=!1;var le={};ue&&(le[ue]=ce&&"".concat(ce,"-").concat(g));var X={};k&&(Array.isArray(k)?k[g]&&(X=k[g]):X=k),re.push(c.default.createElement(Ce,R({id:d&&"".concat(d,"-").concat(g),autoComplete:m??"off",placeholder:oe&&oe[g],key:g,index:g,focus:r===g,value:ae&&ae[g],onChange:e.handleOnChange,onKeyDown:e.handleOnKeyDown,onInput:e.handleOnInput,onPaste:e.handleOnPaste,onFocus:function(je){e.setState({activeInput:g}),je.target.select()},onBlur:function(){return e.setState({activeInput:-1})},separator:I,inputStyle:y,focusStyle:v,isLastChild:g===S-1,isDisabled:C,disabledStyle:q,hasErrored:z,errorStyle:K,isSuccessed:G,successStyle:Q,shouldAutoFocus:De,isInputNum:_e,isInputSecure:Ee,className:Ae,"data-cy":ie&&"".concat(ie,"-").concat(g),"data-testid":se&&"".concat(se,"-").concat(g),shouldRender:J,onSubmit:Re},X,le)))},Y=0;Y<S;Y++)xe(Y);return re}),e}return $(s,[{key:"componentDidUpdate",value:function(){var a=this.props.value,u=this.state.activeInput;a==""&&u>0&&this.setState({activeInput:0})}},{key:"render",value:function(){var a=this.props.containerStyle;return c.default.createElement("div",{style:Object.assign({display:"flex"},_(a)&&a),className:_(a)?"":a},this.renderInputs())}}]),s}(c.Component);p(ne,"defaultProps",{numInputs:4,onChange:function(o){return console.log(o)},isDisabled:!1,shouldAutoFocus:!1,value:"",isInputSecure:!1,onSubmit:function(o){return console.log(o)}});var we=ne;t.default=we})(ye);const Ze=ke(ye),et=function(t){const c=tt();return b.jsx(Ge,{icon:b.jsx(nt,{state:t.state,period:t.period}),children:b.jsx("span",{className:c.otpInput,id:"otp-input",children:b.jsx(Ze,{shouldAutoFocus:!0,onChange:t.onChange,value:t.passcode,numInputs:t.digits,isDisabled:t.state===A.InProgress||t.state===A.Success,isInputNum:!0,hasErrored:t.state===A.Failure,autoComplete:"one-time-code",inputStyle:Ke(c.otpDigitInput,t.state===A.Failure?c.inputError:"")})})})},tt=Ve(t=>({timeProgress:{},register:{marginTop:t.spacing()},otpInput:{display:"inline-block",marginTop:t.spacing(2)},otpDigitInput:{boxSizing:"content-box",padding:t.spacing()+" !important",marginLeft:t.spacing(.5),marginRight:t.spacing(.5),fontSize:"1rem",borderRadius:"5px",border:"1px solid rgba(0,0,0,0.3)"},inputError:{border:"1px solid rgba(255, 2, 2, 0.95)"}}));function nt(t){return b.jsxs(O.Fragment,{children:[t.state!==A.Success?b.jsx(ze,{backgroundColor:"#000",color:"#FFFFFF",width:64,height:64,period:t.period}):null,t.state===A.Success?b.jsx(qe,{}):null]})}var A=(t=>(t[t.Idle=1]="Idle",t[t.InProgress=2]="InProgress",t[t.Success=3]="Success",t[t.Failure=4]="Failure",t))(A||{});const rt=function(t){const[c,j]=O.useState(""),[N,P]=O.useState(t.authenticationLevel===V.TwoFactor?3:1),R=Me($e),[M,W]=Be(),{t:x}=We(),{onSignInSuccess:U,onSignInError:$}=t,F=O.useRef($).current,L=O.useRef(U).current,[h,B,,f]=Je();O.useEffect(()=>{f&&(console.error(f),F(new Error(x("Could not obtain user settings"))),P(4))},[F,f,x]),O.useEffect(()=>{t.registered&&t.authenticationLevel===V.OneFactor&&B()},[B,t.authenticationLevel,t.registered]);const H=O.useCallback(async()=>{if(!t.registered||t.authenticationLevel===V.TwoFactor)return;const p=`${c}`;if(!(!c||p.length!==((h==null?void 0:h.digits)||6))){try{P(2);const T=await Xe(p,R,M,W);P(3),L(T?T.redirect:void 0)}catch(T){console.error(T),F(new Error("The one-time password might be wrong")),P(4)}j("")}},[F,L,c,R,M,W,h,t.authenticationLevel,t.registered]);O.useEffect(()=>{t.authenticationLevel>=V.TwoFactor&&P(3)},[t.authenticationLevel,P]),O.useEffect(()=>{H()},[H]);let D=Z.METHOD;return t.authenticationLevel===V.TwoFactor?D=Z.ALREADY_AUTHENTICATED:t.registered||(D=Z.NOT_REGISTERED),b.jsx(He,{id:t.id,title:x("One-Time Password"),explanation:x("Enter one-time password"),duoSelfEnrollment:!1,registered:t.registered,state:D,onRegisterClick:t.onRegisterClick,children:b.jsx("div",{children:h!==void 0||f!==void 0?b.jsx(et,{passcode:c,period:(h==null?void 0:h.period)||30,digits:(h==null?void 0:h.digits)||6,onChange:j,state:N}):b.jsx(Ue,{})})})},yt=Object.freeze(Object.defineProperty({__proto__:null,State:A,default:rt},Symbol.toStringTag,{value:"Module"}));export{et as O,A as S,yt as a,gt as c,ht as d,dt as g,mt as s,pt as t,vt as u};
